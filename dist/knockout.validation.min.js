/*=============================================================================
	Author:			Eric M. Barnard - @ericmbarnard								
	License:		MIT (http://opensource.org/licenses/mit-license.php)		
																				
	Description:	Validation Library for KnockoutJS							
	Version:		2.0.3											
===============================================================================
*/

!function(a){"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?a(require("knockout"),exports):"function"==typeof define&&define.amd?define(["knockout","exports"],a):a(ko,ko.validation={})}(function(a,b){function c(a){var b="max"===a;return function(c,d){if(h.utils.isEmptyVal(c))return!0;var e,f;void 0===d.typeAttr?(f="text",e=d):(f=d.typeAttr,e=d.value),isNaN(e)||e instanceof Date||(f="number");var g,i,j;switch(f.toLowerCase()){case"week":if(g=/^(\d{4})-W(\d{2})$/,i=c.match(g),null===i)throw new Error("Invalid value for "+a+" attribute for week input.  Should look like '2000-W33' http://www.w3.org/TR/html-markup/input.week.html#input.week.attrs.min");return j=e.match(g),j?b?i[1]<j[1]||i[1]===j[1]&&i[2]<=j[2]:i[1]>j[1]||i[1]===j[1]&&i[2]>=j[2]:!1;case"month":if(g=/^(\d{4})-(\d{2})$/,i=c.match(g),null===i)throw new Error("Invalid value for "+a+" attribute for month input.  Should look like '2000-03' http://www.w3.org/TR/html-markup/input.month.html#input.month.attrs.min");return j=e.match(g),j?b?i[1]<j[1]||i[1]===j[1]&&i[2]<=j[2]:i[1]>j[1]||i[1]===j[1]&&i[2]>=j[2]:!1;case"number":case"range":return b?!isNaN(c)&&parseFloat(c)<=parseFloat(e):!isNaN(c)&&parseFloat(c)>=parseFloat(e);default:return b?e>=c:c>=e}}}function d(a,b,c){return b.validator(a(),void 0===c.params?!0:j(c.params))?!0:(a.setError(h.formatMessage(c.message||b.message,j(c.params),a)),!1)}function e(a,b,c){a.isValidating(!0);var d=function(d){var e=!1,f="";return a.__valid__()?(d.message?(e=d.isValid,f=d.message):e=d,e||(a.error(h.formatMessage(f||c.message||b.message,j(c.params),a)),a.__valid__(e)),void a.isValidating(!1)):void a.isValidating(!1)};h.utils.async(function(){b.validator(a(),void 0===c.params?!0:j(c.params),d)})}function f(a,b,c){if(a=b.rule?h.rules[b.rule]:b,a.async||b.async)e(c,a,b);else if(!d(c,a,b))return!1;return!0}function g(a,b,c){b.validateTimeoutInstance&&clearTimeout(b.validateTimeoutInstance),b.validateTimeoutInstance=setTimeout(function(){c.isValidating(!0),f(a,b,c)&&c.clearError()},b.throttle)}if("undefined"==typeof a)throw new Error("Knockout is required, please ensure it is loaded before loading this validation plug-in");a.validation=b;var h=a.validation,i=a.utils,j=i.unwrapObservable,k=i.arrayForEach,l=i.extend,m={registerExtenders:!0,messagesOnModified:!0,errorsAsTitle:!0,errorsAsTitleOnModified:!1,messageTemplate:null,insertMessages:!0,parseInputAttributes:!1,writeInputAttributes:!1,decorateInputElement:!1,decorateElementOnModified:!0,errorClass:null,errorElementClass:"validationElement",errorMessageClass:"validationMessage",allowHtmlMessages:!1,grouping:{deep:!1,observable:!0,live:!1},validate:{}},n=l({},m);n.html5Attributes=["required","pattern","min","max","step"],n.html5InputTypes=["email","number","date"],n.reset=function(){l(n,m)},h.configuration=n,h.utils=function(){var a=(new Date).getTime(),b={},c="__ko_validation__";return{isArray:function(a){return a.isArray||"[object Array]"===Object.prototype.toString.call(a)},isObject:function(a){return null!==a&&"object"==typeof a},isNumber:function(a){return!isNaN(a)},isObservableArray:function(a){return!!a&&"function"==typeof a.remove&&"function"==typeof a.removeAll&&"function"==typeof a.destroy&&"function"==typeof a.destroyAll&&"function"==typeof a.indexOf&&"function"==typeof a.replace},values:function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(a[c]);return b},getValue:function(a){return"function"==typeof a?a():a},hasAttribute:function(a,b){return null!==a.getAttribute(b)},getAttribute:function(a,b){return a.getAttribute(b)},setAttribute:function(a,b,c){return a.setAttribute(b,c)},isValidatable:function(a){return!!(a&&a.rules&&a.isValid&&a.isModified)},insertAfter:function(a,b){a.parentNode.insertBefore(b,a.nextSibling)},newId:function(){return a+=1},getConfigOptions:function(a){var b=h.utils.contextFor(a);return b||h.configuration},setDomData:function(a,d){var e=a[c];e||(a[c]=e=h.utils.newId()),b[e]=d},getDomData:function(a){var d=a[c];return d?b[d]:void 0},contextFor:function(a){switch(a.nodeType){case 1:case 8:var b=h.utils.getDomData(a);if(b)return b;if(a.parentNode)return h.utils.contextFor(a.parentNode)}return void 0},isEmptyVal:function(a){return void 0===a?!0:null===a?!0:""===a?!0:void 0},getOriginalElementTitle:function(a){var b=h.utils.getAttribute(a,"data-orig-title"),c=a.title,d=h.utils.hasAttribute(a,"data-orig-title");return d?b:c},async:function(a){window.setImmediate?window.setImmediate(a):window.setTimeout(a,0)},forEach:function(a,b){if(h.utils.isArray(a))return k(a,b);for(var c in a)a.hasOwnProperty(c)&&b(a[c],c)}}}();var o=function(){function b(a){k(a.subscriptions,function(a){a.dispose()}),a.subscriptions=[]}function c(a){a.options.deep&&(k(a.flagged,function(a){delete a.__kv_traversed}),a.flagged.length=0),a.options.live||b(a)}function d(a,d){d.validatables=[],b(d),e(a,d),c(d)}function e(b,c,d){var f=[],g=b.peek?b.peek():b;b.__kv_traversed!==!0&&(c.options.deep&&(b.__kv_traversed=!0,c.flagged.push(b)),d=void 0!==d?d:c.options.deep?1:-1,a.isObservable(b)&&(b.errors||n.isValidatable(b)||b.extend({validatable:!0}),c.validatables.push(b),c.options.live&&n.isObservableArray(b)&&c.subscriptions.push(b.subscribe(function(){c.graphMonitor.valueHasMutated()}))),g&&!g._destroy&&(n.isArray(g)?f=g:n.isObject(g)&&(f=n.values(g))),0!==d&&n.forEach(f,function(b){!b||b.nodeType||a.isComputed(b)&&!b.rules||e(b,c,d+1)}))}function f(a){var b=[];return k(a,function(a){n.isValidatable(a)&&!a.isValid()&&b.push(a.error.peek())}),b}var g=0,m=h.configuration,n=h.utils;return{init:function(a,b){g>0&&!b||(a=a||{},a.errorElementClass=a.errorElementClass||a.errorClass||m.errorElementClass,a.errorMessageClass=a.errorMessageClass||a.errorClass||m.errorMessageClass,l(m,a),m.registerExtenders&&h.registerExtenders(),g=1)},reset:h.configuration.reset,group:function(b,c){c=l(l({},m.grouping),c);var e={options:c,graphMonitor:a.observable(),flagged:[],subscriptions:[],validatables:[]},g=null;return g=c.observable?a.computed(function(){return e.graphMonitor(),d(b,e),f(e.validatables)}):function(){return d(b,e),f(e.validatables)},g.showAllMessages=function(a){void 0===a&&(a=!0),g.forEach(function(b){n.isValidatable(b)&&b.isModified(a)})},g.isAnyMessageShown=function(){var a;return a=!!g.find(function(a){return n.isValidatable(a)&&!a.isValid()&&a.isModified()})},g.filter=function(a){return a=a||function(){return!0},g(),i.arrayFilter(e.validatables,a)},g.find=function(a){return a=a||function(){return!0},g(),i.arrayFirst(e.validatables,a)},g.forEach=function(a){a=a||function(){},g(),k(e.validatables,a)},g.map=function(a){return a=a||function(a){return a},g(),i.arrayMap(e.validatables,a)},g._updateState=function(a){if(!n.isObject(a))throw new Error("An object is required.");return b=a,c.observable?void e.graphMonitor.valueHasMutated():(d(a,e),f(e.validatables))},g},formatMessage:function(a,b,c){if(n.isObject(b)&&b.typeAttr&&(b=b.value),"function"==typeof a)return a(b,c);var d=j(b);return null==d&&(d=[]),n.isArray(d)||(d=[d]),a.replace(/{(\d+)}/gi,function(a,b){return"undefined"!=typeof d[b]?d[b]:a})},addRule:function(a,b){a.extend({validatable:!0});var c=!!i.arrayFirst(a.rules(),function(a){return a.rule&&a.rule===b.rule});return c||a.rules.push(b),a},addAnonymousRule:function(a,b){void 0===b.message&&(b.message="Error"),b.onlyIf&&(b.condition=b.onlyIf),h.addRule(a,b)},addExtender:function(b){a.extenders[b]=function(a,c){return c&&(c.message||c.onlyIf||c.throttle)?h.addRule(a,{rule:b,message:c.message,params:n.isEmptyVal(c.params)?!0:c.params,condition:c.onlyIf,throttle:c.throttle}):h.addRule(a,{rule:b,params:c})}},registerExtenders:function(){if(m.registerExtenders)for(var b in h.rules)h.rules.hasOwnProperty(b)&&(a.extenders[b]||h.addExtender(b))},insertValidationMessage:function(a){var b=document.createElement("SPAN");return b.className=n.getConfigOptions(a).errorMessageClass,n.insertAfter(a,b),b},parseInputValidationAttributes:function(a,b){k(h.configuration.html5Attributes,function(c){if(n.hasAttribute(a,c)){var d=a.getAttribute(c)||!0;if("min"===c||"max"===c){var e=a.getAttribute("type");"undefined"!=typeof e&&e||(e="text"),d={typeAttr:e,value:d}}h.addRule(b(),{rule:c,params:d})}});var c=a.getAttribute("type");k(h.configuration.html5InputTypes,function(a){a===c&&h.addRule(b(),{rule:"date"===a?"dateISO":a,params:!0})})},writeInputValidationAttributes:function(b,c){var d=c();if(d&&d.rules){var e=d.rules();k(h.configuration.html5Attributes,function(c){var d=i.arrayFirst(e,function(a){return a.rule&&a.rule.toLowerCase()===c.toLowerCase()});d&&a.computed({read:function(){var e=a.unwrap(d.params);"pattern"===d.rule&&e instanceof RegExp&&(e=e.source),b.setAttribute(c,e)},disposeWhenNodeIsRemoved:b})}),e=null}},makeBindingHandlerValidatable:function(b){var c=a.bindingHandlers[b].init;a.bindingHandlers[b].init=function(b,d,e,f,g){return c(b,d,e,f,g),a.bindingHandlers.validationCore.init(b,d,e,f,g)}},setRules:function(b,c){var d=function(b,c){if(b&&c)for(var e in c)if(c.hasOwnProperty(e)){var f=c[e];if(b[e]){var g=b[e],i=j(g),k={},l={};for(var m in f)f.hasOwnProperty(m)&&(h.rules[m]?k[m]=f[m]:l[m]=f[m]);if(a.isObservable(g)&&g.extend(k),i&&n.isArray(i))for(var o=0;o<i.length;o++)d(i[o],l);else d(i,l)}}};d(b,c)}}}();l(a.validation,o),h.rules={},h.rules.required={validator:function(a,b){var c;return void 0===a||null===a?!b:(c=a,"string"==typeof a&&(c=String.prototype.trim?a.trim():a.replace(/^\s+|\s+$/g,"")),b?(c+"").length>0:!0)},message:"This field is required."},h.rules.min={validator:c("min"),message:"Please enter a value greater than or equal to {0}."},h.rules.max={validator:c("max"),message:"Please enter a value less than or equal to {0}."},h.rules.minLength={validator:function(a,b){if(h.utils.isEmptyVal(a))return!0;var c=h.utils.isNumber(a)?""+a:a;return c.length>=b},message:"Please enter at least {0} characters."},h.rules.maxLength={validator:function(a,b){if(h.utils.isEmptyVal(a))return!0;var c=h.utils.isNumber(a)?""+a:a;return c.length<=b},message:"Please enter no more than {0} characters."},h.rules.pattern={validator:function(a,b){return h.utils.isEmptyVal(a)||null!==a.toString().match(b)},message:"Please check this value."},h.rules.step={validator:function(a,b){if(h.utils.isEmptyVal(a)||"any"===b)return!0;var c=100*a%(100*b);return Math.abs(c)<1e-5||Math.abs(1-c)<1e-5},message:"The value must increment by {0}."},h.rules.email={validator:function(a,b){return b?h.utils.isEmptyVal(a)||b&&/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i.test(a):!0},message:"Please enter a proper email address."},h.rules.date={validator:function(a,b){return b?h.utils.isEmptyVal(a)||b&&!/Invalid|NaN/.test(new Date(a)):!0},message:"Please enter a proper date."},h.rules.dateISO={validator:function(a,b){return b?h.utils.isEmptyVal(a)||b&&/^\d{4}[-\/](?:0?[1-9]|1[012])[-\/](?:0?[1-9]|[12][0-9]|3[01])$/.test(a):!0},message:"Please enter a proper date."},h.rules.number={validator:function(a,b){return b?h.utils.isEmptyVal(a)||b&&/^-?(?:\d+|\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/.test(a):!0},message:"Please enter a number."},h.rules.digit={validator:function(a,b){return b?h.utils.isEmptyVal(a)||b&&/^\d+$/.test(a):!0},message:"Please enter a digit."},h.rules.phoneUS={validator:function(a,b){return b?h.utils.isEmptyVal(a)?!0:"string"!=typeof a?!1:(a=a.replace(/\s+/g,""),b&&a.length>9&&a.match(/^(1-?)?(\([2-9]\d{2}\)|[2-9]\d{2})-?[2-9]\d{2}-?\d{4}$/)):!0},message:"Please specify a valid phone number."},h.rules.equal={validator:function(a,b){var c=b;return a===h.utils.getValue(c)},message:"Values must equal."},h.rules.notEqual={validator:function(a,b){var c=b;return a!==h.utils.getValue(c)},message:"Please choose another value."},h.rules.unique={validator:function(a,b){var c=h.utils.getValue(b.collection),d=h.utils.getValue(b.externalValue),e=0;return a&&c?(i.arrayFilter(c,function(c){a===(b.valueAccessor?b.valueAccessor(c):c)&&e++}),(d?1:2)>e):!0},message:"Please make sure the value is unique."},function(){h.registerExtenders()}(),a.bindingHandlers.validationCore=function(){return{init:function(b,c){var d=h.utils.getConfigOptions(b),e=c();if(d.parseInputAttributes&&h.utils.async(function(){h.parseInputValidationAttributes(b,c)}),d.insertMessages&&h.utils.isValidatable(e)){var f=h.insertValidationMessage(b);d.messageTemplate?a.renderTemplate(d.messageTemplate,{field:e},null,f,"replaceNode"):a.applyBindingsToNode(f,{validationMessage:e})}d.writeInputAttributes&&h.utils.isValidatable(e)&&h.writeInputValidationAttributes(b,c),d.decorateInputElement&&h.utils.isValidatable(e)&&a.applyBindingsToNode(b,{validationElement:e})}}}(),h.makeBindingHandlerValidatable("value"),h.makeBindingHandlerValidatable("checked"),a.bindingHandlers.textInput&&h.makeBindingHandlerValidatable("textInput"),h.makeBindingHandlerValidatable("selectedOptions"),a.bindingHandlers.validationMessage={update:function(b,c){var d=c(),e=h.utils.getConfigOptions(b),f=(j(d),!1),g=!1;if(null===d||"undefined"==typeof d)throw new Error("Cannot bind validationMessage to undefined value. data-bind expression: "+b.getAttribute("data-bind"));f=d.isModified&&d.isModified(),g=d.isValid&&d.isValid();var k=null;(!e.messagesOnModified||f)&&(k=g?null:d.error);var l=!e.messagesOnModified||f?!g:!1,m="none"!==b.style.display;e.allowHtmlMessages?i.setHtml(b,k):a.bindingHandlers.text.update(b,function(){return k}),m&&!l?b.style.display="none":!m&&l&&(b.style.display="")}},a.bindingHandlers.validationElement={update:function(b,c,d){var e=c(),f=h.utils.getConfigOptions(b),g=(j(e),!1),i=!1;if(null===e||"undefined"==typeof e)throw new Error("Cannot bind validationElement to undefined value. data-bind expression: "+b.getAttribute("data-bind"));g=e.isModified&&e.isModified(),i=e.isValid&&e.isValid();var k=function(){var a={},b=!f.decorateElementOnModified||g?!i:!1;return a[f.errorElementClass]=b,a};a.bindingHandlers.css.update(b,k,d),f.errorsAsTitle&&a.bindingHandlers.attr.update(b,function(){var a=!f.errorsAsTitleOnModified||g,c=h.utils.getOriginalElementTitle(b);return a&&!i?{title:e.error,"data-orig-title":c}:!a||i?{title:c,"data-orig-title":null}:void 0})}},a.bindingHandlers.validationOptions=function(){return{init:function(a,b){var c=j(b());if(c){var d=l({},h.configuration);l(d,c),h.utils.setDomData(a,d)}}}}(),a.extenders.validation=function(a,b){return k(h.utils.isArray(b)?b:[b],function(b){h.addAnonymousRule(a,b)}),a},a.extenders.validatable=function(b,c){if(h.utils.isObject(c)||(c={enable:c}),"enable"in c||(c.enable=!0),c.enable&&!h.utils.isValidatable(b)){var d=h.configuration.validate||{},e={throttleEvaluation:c.throttle||d.throttle};b.error=a.observable(null),b.rules=a.observableArray(),b.isValidating=a.observable(!1),b.__valid__=a.observable(!0),b.isModified=a.observable(!1),b.isValid=a.computed(b.__valid__),b.setError=function(a){var c=b.error.peek(),d=b.__valid__.peek();b.error(a),b.__valid__(!1),c===a||d||b.isValid.notifySubscribers()},b.clearError=function(){return b.error(null),b.__valid__(!0),b};var f=b.subscribe(function(){b.isModified(!0)}),g=a.computed(l({read:function(){b(),b.rules();return h.validateObservable(b),!0}},e));l(g,e),b._disposeValidation=function(){b.isValid.dispose(),b.rules.removeAll(),f.dispose(),g.dispose(),delete b.rules,delete b.error,delete b.isValid,delete b.isValidating,delete b.__valid__,delete b.isModified,delete b.setError,delete b.clearError,delete b._disposeValidation}}else c.enable===!1&&b._disposeValidation&&b._disposeValidation();return b},h.validateObservable=function(a){for(var b,c,d=0,e=a.rules(),h=e.length;h>d;d++)if(c=e[d],!c.condition||c.condition()){if(c.throttle)return a.isValidating(1),g(b,c,a),!1;if(!f(b,c,a))return!1}return a.clearError(),!0};var p,q={};h.defineLocale=function(a,b){return a&&b?(q[a.toLowerCase()]=b,b):null},h.locale=function(a){if(a){if(a=a.toLowerCase(),!q.hasOwnProperty(a))throw new Error("Localization "+a+" has not been loaded.");h.localize(q[a]),p=a}return p},h.localize=function(a){var b=h.rules;for(var c in a)b.hasOwnProperty(c)&&(b[c].message=a[c])},function(){var a={},b=h.rules;for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c].message);h.defineLocale("en-us",a)}(),p="en-us",a.applyBindingsWithValidation=function(b,c,d){var e,f=document.body;c&&c.nodeType?(f=c,e=d):e=c,h.init(),e&&(e=l(l({},h.configuration),e),h.utils.setDomData(f,e)),a.applyBindings(b,f)};var r=a.applyBindings;a.applyBindings=function(a,b){h.init(),r(a,b)},a.validatedObservable=function(b,c){if(!c&&!h.utils.isObject(b))return a.observable(b).extend({validatable:!0});var d=a.observable(b);return d.errors=h.group(h.utils.isObject(b)?b:{},c),d.isValid=a.observable(0===d.errors().length),a.isObservable(d.errors)?d.errors.subscribe(function(a){d.isValid(0===a.length)}):a.computed(d.errors).subscribe(function(a){d.isValid(0===a.length)}),d.subscribe(function(a){h.utils.isObject(a)||(a={}),d.errors._updateState(a),d.isValid(0===d.errors().length)}),d}});
//# sourceMappingURL=knockout.validation.min.js.map